<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bit Builders – Round 3 Unlock</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rubik:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Rubik', sans-serif;
      background: radial-gradient(circle at center, #060606 0%, #000 100%);
      color: #fff;
      overflow: hidden;
    }

    #tsparticles {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      padding: 2rem;
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      color: #00ffe0;
      margin-bottom: 1rem;
      text-shadow: 0 0 10px #00ffe0;
    }

    p {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: #ccc;
    }

    select {
      background: #111;
      color: #00ffe0;
      border: 2px solid #00ffe0;
      border-radius: 8px;
      padding: 0.4rem 0.8rem;
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    #input-area {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    input[type="text"] {
      width: 2.5rem;
      height: 2.5rem;
      text-align: center;
      font-size: 1.4rem;
      font-family: 'Orbitron', sans-serif;
      background: #000;
      border: 2px solid #00ffe0;
      border-radius: 6px;
      color: #00ffe0;
      transition: all 0.2s ease;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #0ff;
      box-shadow: 0 0 8px #00ffe0;
    }

    #submit-btn {
      background: #00ffe0;
      border: none;
      border-radius: 8px;
      color: #000;
      font-size: 1rem;
      font-weight: bold;
      padding: 0.6rem 1.2rem;
      cursor: pointer;
      transition: 0.3s;
    }

    #submit-btn:hover {
      transform: scale(1.05);
      background: #0ff;
    }

    #message {
      font-size: 1rem;
      margin-top: 1rem;
      height: 1.5rem;
    }

    #qr-container {
      margin-top: 1.5rem;
      display: none;
      animation: fadeIn 1s forwards;
    }

    #qr-container img {
      width: 200px;
      border: 3px solid #00ffe0;
      border-radius: 10px;
      box-shadow: 0 0 15px #00ffe0;
    }

    .shake {
      animation: shake 0.4s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    #progress {
      width: 80%;
      height: 8px;
      background: #222;
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    #progress-bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #00ffe0, #0080ff);
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <canvas id="tsparticles"></canvas>
  <main>
    <h1>Bit Builders – Round 3</h1>
    <p>Enter the <b>first letters</b> of all 20 answers in the correct order to unlock the secret QR code.</p>

    <select id="mode">
      <option value="single">Single Input</option>
      <option value="multi">20 Boxes</option>
    </select>

    <div id="progress"><div id="progress-bar"></div></div>

    <div id="input-area"></div>

    <button id="submit-btn">Unlock</button>
    <div id="message"></div>

    <div id="qr-container">
      <img id="qr-image" src="files/qr.png" alt="QR Code">
    </div>
  </main>

  <script>
    // === PARTICLES BACKGROUND ===
    tsParticles.load("tsparticles", {
      fullScreen: { enable: true, zIndex: -1 },
      particles: {
        color: { value: "#00ffe0" },
        links: { enable: true, color: "#00ffe0" },
        move: { enable: true, speed: 0.6 },
        number: { value: 50 },
        opacity: { value: 0.5 },
        size: { value: { min: 1, max: 3 } }
      }
    });

    const inputArea = document.getElementById("input-area");
    const modeSelect = document.getElementById("mode");
    const progressBar = document.getElementById("progress-bar");
    const message = document.getElementById("message");
    const qrContainer = document.getElementById("qr-container");

    let inputs = [];

    function renderInputs(mode) {
      inputArea.innerHTML = "";
      inputs = [];
      if (mode === "single") {
        const input = document.createElement("input");
        input.type = "text";
        input.maxLength = 20;
        input.placeholder = "Enter 20 letters";
        inputArea.appendChild(input);
        inputs.push(input);
      } else {
        for (let i = 0; i < 20; i++) {
          const input = document.createElement("input");
          input.type = "text";
          input.maxLength = 1;
          inputArea.appendChild(input);
          inputs.push(input);
        }
      }
    }

    modeSelect.addEventListener("change", () => {
      renderInputs(modeSelect.value);
      progressBar.style.width = "0%";
      message.textContent = "";
      qrContainer.style.display = "none";
    });

    renderInputs("single");

    function getUserInput() {
      let combined = "";
      if (modeSelect.value === "single") {
        combined = inputs[0].value.toUpperCase().replace(/[^A-Z]/g, "");
      } else {
        combined = inputs.map(i => i.value.toUpperCase()).join("").replace(/[^A-Z]/g, "");
      }
      progressBar.style.width = `${(combined.length / 20) * 100}%`;
      return combined;
    }

    inputs.forEach(inp => inp.addEventListener("input", getUserInput));

    document.getElementById("submit-btn").addEventListener("click", async () => {
      message.textContent = "Checking...";
      const userKey = getUserInput();

      try {
        const response = await fetch("files/key.txt");
        const keyText = (await response.text()).trim().toUpperCase();

        if (userKey === keyText) {
          message.textContent = "Access Granted ✅";
          qrContainer.style.display = "block";
          confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        } else {
          message.textContent = "Incorrect Code ❌";
          inputArea.classList.add("shake");
          setTimeout(() => inputArea.classList.remove("shake"), 400);
        }
      } catch (err) {
        message.textContent = "Error fetching key file.";
      }
    });
  </script>
</body>
</html>
